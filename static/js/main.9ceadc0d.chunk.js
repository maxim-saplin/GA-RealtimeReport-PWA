(window["webpackJsonpGA-RealtimeReport-PWA"]=window["webpackJsonpGA-RealtimeReport-PWA"]||[]).push([[0],{26:function(e,t,n){e.exports=n(37)},31:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),a=n(13),c=n.n(a),i=function(){return{type:"AUTHORIZE_AUTO"}},u=function(e){return{type:"AUTHORIZATION_FAILED",autoMode:e}},s=function(){return{type:"AUTHORIZATION_OK"}},l=function(e){return{type:"AUTH_RECEIVE_ACCOUNTS",accounts:e}},d=function(e){return{type:"GA_GET_ALL_DATA",viewId:e}},p=function(e){return{type:"GA_GET_RT_DATA",viewId:e}},f=function(e){return{type:"GA_RECEIVE_RT_DATA",data:e.data,viewId:e.viewId,reAuth:e.reAuth}},h=function(e){return{type:"GA_GET_DATA",viewId:e}},v=function(e){return{type:"GA_RECEIVE_DATA",data:e.data,viewId:e.viewId,reAuth:e.reAuth}},O=(n(31),n(15)),A=n(1),w=n(5),g=n(17),y=n(11),m=n(24);function E(e){var t=e.component,n=e.conditionEval,r=Object(m.a)(e,["component","conditionEval"]);return o.a.createElement(y.b,Object.assign({},r,{render:function(e){return n()?o.a.createElement(t,e):o.a.createElement(y.a,{to:{pathname:"/auth",state:{referrer:e.location}}})}}))}var b=n(9);function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(n,!0).forEach((function(t){Object(b.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var j,_="48841825057-engcdce3j4sfo5j5v4pc3hrpe9fgv1mu.apps.googleusercontent.com",R=["https://www.googleapis.com/auth/analytics.readonly"],P=window.gapi;function U(e){var t={client_id:_,scope:R,immediate:e};return P.auth.authorize(t,(function(e){if(e.error)throw new Error("GAPI - Authorization failed")}))}function D(){return P.client.load("analytics","v3").then((function(){return P.client.analytics.management.accounts.list().then((function(e){if(e.result.items&&e.result.items.length){var t=e.result.items.map((function(e){return{id:e.id,name:e.name}}));return P.client.analytics.management.webproperties.list({accountId:"~all"}).then((function(e){if(e.result.items&&e.result.items.length)return t.forEach((function(t){t.properties=e.result.items.filter((function(e){return e.accountId===t.id})).map((function(e){return{id:e.id,name:e.name}}))})),P.client.analytics.management.profiles.list({accountId:"~all",webPropertyId:"~all"}).then((function(e){if(e.result.items&&e.result.items.length)return t.forEach((function(t){t.properties.forEach((function(t){t.views=e.result.items.filter((function(e){return e.webPropertyId===t.id})).map((function(e){return{id:e.id,name:e.name}}))}))})),t}))}))}console.log("No accounts found for this user.")}))}))}var N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{authorized:!1,authorizing:!1},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"AUTHORIZE_REFRESH_TOKEN":return Object(A.d)(e,A.a.run((function(){return U(!0)}),{successActionCreator:function(){return d(t.viewId)}}));case"AUTHORIZE_AUTO":case"AUTHORIZE_MANUAL":return Object(A.d)(T({},e,{authorizing:!0}),A.a.run((function(){return U("AUTHORIZE_AUTO"===t.type)}),{successActionCreator:s,failActionCreator:u,args:["AUTHORIZE_AUTO"===t.type]}));case"AUTHORIZATION_OK":return Object(A.d)(T({},e,{authorized:!0,authorizing:!1}),A.a.action({type:"AUTH_GET_ACCOUNTS"}));case"AUTHORIZATION_FAILED":return T({},e,{authorized:!1,authorizing:!1});case"AUTHORIZE_SINGOUT":return Object(A.d)(T({},e,{authorized:!1,authorizing:!1}),A.a.run((function(){P.auth.setToken(null),P.auth.signOut()})));case"AUTH_GET_ACCOUNTS":return Object(A.d)(e,A.a.run((function(){return D()}),{successActionCreator:l}));case"AUTH_RECEIVE_ACCOUNTS":return T({},e,{availableAccounts:t.accounts});case"AUTH_CHOOSE_ACCOUNT":var n=!1;return t.account.viewId&&j!==t.account.viewId&&(n=!0,j=t.account.viewId),n?Object(A.d)(T({},e,{currentAccount:t.account}),A.a.action({type:"GA_GET_ALL_DATA",viewId:t.account.viewId})):T({},e,{currentAccount:t.account});default:return e}};function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(n,!0).forEach((function(t){Object(b.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function S(e,t){var n=t().auth;n&&n.currentAccount&&n.currentAccount.viewId&&(e(i()),e(p(n.currentAccount.viewId)),e(h(n.currentAccount.viewId)))}var k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{online:!0},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"NETWORK_ONLINE":return Object(A.d)(G({},e,{online:!0}),A.a.run(S,{args:[A.a.dispatch,A.a.getState]}));case"NETWORK_OFFLINE":return G({},e,{online:!1});default:return e}};function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(n,!0).forEach((function(t){Object(b.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var L,W,Z=window.gapi;function F(e){return Z.client.analytics.data.realtime.get({ids:"ga:"+e,metrics:"rt:activeUsers",dimensions:"rt:country",fields:"rows,totalsForAllResults"}).then((function(t){return{data:{usersNow:t.result.totalsForAllResults["rt:activeUsers"],countriesAndUsersNow:t.result.rows},viewId:e}})).catch((function(t){if(401===t.status)return{reAuth:!0,viewId:e};console.log("GA RT error: "+t.status)}))}function V(e){return Z.client.analytics.data.ga.get({ids:"ga:"+e,"start-date":"today","end-date":"today",metrics:"ga:users",dimensions:"ga:country",sort:"-ga:users",fields:"rows,totalsForAllResults"}).then((function(t){return{data:{usersToday:t.result.totalsForAllResults["ga:users"],countriesAndUsersToday:t.result.rows},viewId:e}})).catch((function(t){if(401===t.status)return{reAuth:!0,viewId:e};console.log("GA error: "+t.status)}))}var K=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{usersNow:0,usersToday:0},t=arguments.length>1?arguments[1]:void 0;if(("GA_RECEIVE_RT_DATA"===t.type||"GA_RECEIVE_DATA"===t.type)&&t.reAuth&&!0===t.reAuth)return Object(A.d)(z({},e,{fetching:!1}),A.a.list([A.a.action({type:"AUTHORIZE_REFRESH_TOKEN",viewId:t.viewId})]));switch(t.type){case"GA_GET_ALL_DATA":return Object(A.d)(e,A.a.list([A.a.action({type:"GA_GET_RT_DATA",viewId:t.viewId}),A.a.action({type:"GA_GET_DATA",viewId:t.viewId})]));case"GA_GET_RT_DATA":return clearTimeout(L),Object(A.d)(z({},e,{fetching:!0}),A.a.run((function(){return F(t.viewId)}),{successActionCreator:f}));case"GA_RECEIVE_RT_DATA":return Object(A.d)(z({},e,{fetching:!1,usersNow:t.data.usersNow,countriesAndUsersNow:t.data.countriesAndUsersNow}),A.a.run((function(e,t){L=setTimeout((function(){return e(p(t))}),3e3)}),{args:[A.a.dispatch,t.viewId]}));case"GA_GET_DATA":return clearTimeout(W),Object(A.d)(z({},e,{fetching:!0}),A.a.run((function(){return V(t.viewId)}),{successActionCreator:v}));case"GA_RECEIVE_DATA":return Object(A.d)(z({},e,{fetching:!1,usersToday:t.data.usersToday,countriesAndUsersToday:t.data.countriesAndUsersToday}),A.a.run((function(e,t){W=setTimeout((function(){return e(h(t))}),12e3)}),{args:[A.a.dispatch,t.viewId]}));default:return e}},x=Object(A.b)({auth:N,gaData:K,network:k});var M=function(e){var t=e.availableAccounts,n=e.currentAccount,r=e.onAccountChoice;function a(e,t){var n=!0,r=!1,o=void 0;try{for(var a,c=e[Symbol.iterator]();!(n=(a=c.next()).done);n=!0){var i=a.value;if(i.id===t)return i}}catch(u){r=!0,o=u}finally{try{n||null==c.return||c.return()}finally{if(r)throw o}}return null}var c=null,i=null,u=null;if(n&&(c=n.accountId,i=n.propertyId,u=n.viewId),null===c&&t&&t.length>0){var s=t[0];if(c=s.id,s.properties&&s.properties.length>0){var l=t[0].properties[0];if(i=l.id,l.views&&l.views.length>0){var d=l.views[0];u=d.id}}r({accountId:c,propertyId:i,viewId:u})}var p=c?a(t,c):null,f=i&&p?a(p.properties,i):null,h=u&&f?a(f.views,u):null;return p&&!f&&p.properties&&p.properties.length>0&&r({accountId:c,propertyId:p.properties[0].id,viewId:u}),f&&!h&&f.views&&f.views.length>0&&r({accountId:c,propertyId:i,viewId:f.views[0].id}),o.a.createElement("div",{id:"account"},o.a.createElement("span",null,"Account"),o.a.createElement("br",null),o.a.createElement("select",{onChange:function(e){return r({accountId:e.target.value,propertyId:i,viewId:u})},value:c||""},p&&t.map((function(e){return o.a.createElement("option",{key:e.id,value:e.id},e.name)}))),o.a.createElement("br",null),o.a.createElement("span",null,"Property"),o.a.createElement("br",null),o.a.createElement("select",{onChange:function(e){return r({accountId:c,propertyId:e.target.value,viewId:u})},value:i||""},f&&p.properties.map((function(e){return o.a.createElement("option",{key:e.id,value:e.id},e.name)}))),o.a.createElement("br",null),o.a.createElement("span",null,"View"),o.a.createElement("br",null),o.a.createElement("select",{onChange:function(e){return r({accountId:c,propertyId:i,viewId:e.target.value})},value:u||""},h&&f.views.map((function(e){return o.a.createElement("option",{key:e.id,value:e.id},e.name)}))),o.a.createElement("br",null))};function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var J=Object(w.b)((function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(n,!0).forEach((function(t){Object(b.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e.auth)}),(function(e){return{onAccountChoice:function(t){e(function(e){return{type:"AUTH_CHOOSE_ACCOUNT",account:e}}(t))}}}))(M);function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var q=Object(w.b)((function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(n,!0).forEach((function(t){Object(b.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e.auth)}),(function(e){return{onSignIn:function(){e({type:"AUTHORIZE_MANUAL"})},onSignOut:function(){e({type:"AUTHORIZE_SINGOUT"})}}}))((function(e){var t=e.authorized,n=e.onSignIn,r=e.onSignOut,a=e.history;return o.a.createElement("div",{id:"navigation"},!t&&o.a.createElement("button",{onClick:n},"Sign in"),t&&"/auth"===a.location.pathname&&o.a.createElement("button",{onClick:r},"Sign out"),t&&"/auth"===a.location.pathname&&o.a.createElement("button",{onClick:function(){return a.push("/")}},"Proceed"),t&&"/auth"!==a.location.pathname&&o.a.createElement("button",{onClick:function(){return a.push("/auth")}},"Switch"))}));var Q=function(e){var t=e.online,n=e.authorized,r=e.currentAccount;return o.a.createElement("div",{id:"status"},t?"Online; ":"Offline;",n?"Authorized; ":"Not Authorizded;",r?"GA Selected; ":"GA Not Selected;")},X=Object(w.b)((function(e){return{online:e.network.online,authorized:e.auth.authorized,currentAccount:e.auth.currentAccount}}))(Q);var Y=function(e){var t=e.users,n=e.countriesAndUsers,r=e.title;return o.a.createElement("div",{class:"users"},o.a.createElement("h2",null,r),o.a.createElement("h1",null,t),n&&n.length>0&&n.map((function(e){return o.a.createElement(o.a.Fragment,null,o.a.createElement("span",{key:e[0]},e[0]),o.a.createElement("span",{class:"right"},e[1]),o.a.createElement("br",null))})))},ee=Object(w.b)((function(e){return{users:e.gaData.usersNow,countriesAndUsers:e.gaData.countriesAndUsersNow,title:"Now"}}))(Y),te=Object(w.b)((function(e){return{users:e.gaData.usersToday,countriesAndUsers:e.gaData.countriesAndUsersToday,title:"Today"}}))(Y),ne=Object(O.b)(x,{},Object(A.c)());window.dispatch=ne.dispatch;var re=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function oe(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}c.a.render(o.a.createElement((function(){return o.a.createElement("div",{className:"App"},o.a.createElement(w.a,{store:ne},o.a.createElement(g.a,null,o.a.createElement(y.b,{component:q}),o.a.createElement(y.b,{exact:!0,path:"/auth",component:J}),o.a.createElement("div",{id:"columns"},o.a.createElement(E,{exact:!0,path:"/",component:ee,conditionEval:function(){return ne.getState().auth.authorized}}),o.a.createElement(E,{exact:!0,path:"/",component:te,conditionEval:function(){return ne.getState().auth.authorized}}))),o.a.createElement(X,null)))}),null),document.getElementById("root")),window.gapi.load("auth",(function(){window.dispatch(i())})),window.addEventListener("online",(function(){window.dispatch({type:"NETWORK_ONLINE"})})),window.addEventListener("offline",(function(){window.dispatch({type:"NETWORK_OFFLINE"})})),function(e){if("serviceWorker"in navigator){if(new URL("/GA-RealtimeReport-PWA",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/GA-RealtimeReport-PWA","/service-worker.js");re?(!function(e,t){fetch(e).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):oe(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):oe(t,e)}))}}()}},[[26,1,2]]]);
//# sourceMappingURL=main.9ceadc0d.chunk.js.map